<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MAXI JDC MARKET">
  <meta name="theme-color" content="#0a1929">
  <title>MAXI JDC MARKET ‚Äî Application Mobile</title>
  
  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  
  <style>
    :root{
      --bg0:#0a1929;
      --bg1:#112240;
      --card:#1a365d;
      --card2:#162447;
      --line:rgba(255,255,255,.15);
      --text:#f0f6fc;
      --muted:#8b949e;
      --accent:#00ff88;
      --accent2:#00d4ff;
      --danger:#ff6b6b;
      --warning:#ffa726;
      --shadow: 0 10px 40px rgba(0,0,0,.5);
      --radius:12px;
      --drawerW: 100vw;
      --header-height: 60px;
      --safe-area: env(safe-area-inset-bottom, 0px);
    }
    
    *{box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color: transparent;}
    
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      position: fixed;
    }
    
    body{
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      color:var(--text);
      background: linear-gradient(135deg, var(--bg0) 0%, var(--bg1) 100%);
      line-height:1.6;
      overflow-x:hidden;
      touch-action: manipulation;
      height: 100vh;
      height: -webkit-fill-available;
    }
    
    #app {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .wrap{
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 0 8px 70px;
      transition: transform .3s ease;
      height: 100%;
    }
    body.drawer-open .wrap{ transform: translateX(-20vw); }

    /* HEADER FIXE */
    .header {
      background: rgba(10, 25, 47, 0.98);
      border-bottom: 1px solid var(--line);
      padding: 8px 12px;
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      height: var(--header-height);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.3);
    }

    .logo-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
      flex: 1;
    }

    .logo{
      width: 44px;
      height: 44px;
      border-radius: 10px;
      border: 2px solid var(--accent);
      overflow: hidden;
      flex-shrink: 0;
      display: grid;
      place-items: center;
      background:#0a1929;
      padding: 2px;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    .brand-text h1{
      margin:0;
      font-size:15px;
      font-weight:900;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
      letter-spacing: -0.2px;
    }
    .brand-text p{
      margin:2px 0 0;
      color:var(--muted);
      font-size:10px;
    }

    /* BOUTON PANIER DANS HEADER */
    .cart-btn-header {
      position: relative;
      width: 50px;
      height: 44px;
      border-radius: 10px;
      border: 2px solid var(--accent);
      background: rgba(0, 255, 136, 0.1);
      color: var(--accent);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      flex-shrink: 0;
      transition: all 0.2s ease;
    }
    .cart-btn-header:hover {
      background: rgba(0, 255, 136, 0.2);
      transform: translateY(-1px);
    }
    .cart-btn-header .icon {
      font-size: 18px;
    }
    .cart-btn-header .count {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid var(--accent);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 900;
      position: absolute;
      top: -5px;
      right: -5px;
    }

    /* ZONE RECHERCHE */
    .search-section {
      padding: 8px 8px 0;
      background: var(--bg0);
      position: sticky;
      top: var(--header-height);
      z-index: 990;
    }

    .search-container {
      display: flex;
      gap: 6px;
      align-items: center;
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      padding: 6px;
      box-shadow: var(--shadow);
    }

    .search-input {
      flex: 1;
      min-width: 0;
      position: relative;
    }

    .search-input input {
      width: 100%;
      height: 40px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 0 12px;
      outline: none;
      font-size: 14px;
      transition: all 0.2s ease;
      padding-right: 44px;
    }

    .search-input input:focus {
      border-color: var(--accent);
      background: rgba(255,255,255,.12);
    }

    .search-buttons {
      display: flex;
      gap: 4px;
    }

    .search-btn {
      height: 40px;
      padding: 0 12px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.1);
      color: var(--text);
      cursor: pointer;
      font-weight: 700;
      font-size: 12px;
      transition: all 0.2s ease;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .search-btn:hover {
      background: rgba(255,255,255,.15);
      border-color: var(--accent);
    }

    .search-btn.green {
      background: rgba(0, 255, 136, 0.15);
      border-color: var(--accent);
      color: var(--accent);
    }

    .search-btn.green:hover {
      background: rgba(0, 255, 136, 0.25);
    }

    /* Bouton Entrer dans la recherche */
    .search-enter-btn {
      position: absolute;
      right: 6px;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: 1px solid var(--accent);
      background: rgba(0, 255, 136, 0.15);
      color: var(--accent);
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .search-enter-btn:hover {
      background: rgba(0, 255, 136, 0.25);
    }

    /* INFO BAR DYNAMIQUE HORIZONTALE */
    .info-bar {
      margin-top: 8px;
      padding: 8px;
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      overflow: hidden;
      position: relative;
    }

    .info-bar-container {
      display: flex;
      gap: 20px;
      animation: scrollHorizontal 30s linear infinite;
      white-space: nowrap;
      padding: 5px 0;
    }

    .info-bar-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
      padding: 4px 10px;
      border-radius: 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--line);
      flex-shrink: 0;
    }

    .info-bar-item strong {
      font-weight: 800;
      color: var(--accent2);
    }

    .info-bar-item.qr-item {
      border-color: var(--accent2);
      background: rgba(0, 212, 255, 0.1);
      color: var(--accent2);
      font-weight: 800;
      cursor: pointer;
    }

    .info-bar-item.qr-item:hover {
      background: rgba(0, 212, 255, 0.2);
    }

    /* NOUVELLE BANNI√àRE PROMOTIONNELLE AM√âLIOR√âE */
    .promo-banner {
      background: linear-gradient(135deg, #ff0000 0%, #ff6b00 50%, #ffd000 100%);
      border-radius: var(--radius);
      padding: 0;
      margin: 8px;
      display: flex;
      align-items: stretch;
      justify-content: space-between;
      border: 2px solid #ff9900;
      box-shadow: 0 5px 25px rgba(255, 107, 0, 0.3);
      animation: pulse 2s infinite;
      overflow: hidden;
      position: relative;
    }

    .promo-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 12px 15px;
    }

    .promo-icon {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .promo-text {
      flex: 1;
    }

    .promo-text h4 {
      margin: 0;
      font-size: 16px;
      font-weight: 900;
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      line-height: 1.2;
      letter-spacing: 0.5px;
    }

    .promo-text p {
      margin: 4px 0 0;
      font-size: 12px;
      color: rgba(255,255,255,0.9);
      line-height: 1.3;
    }

    .promo-btn {
      background: rgba(0,0,0,0.3);
      border: 2px solid rgba(255,255,255,0.7);
      color: white;
      padding: 0 20px;
      border-radius: 0;
      font-weight: 900;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 100px;
      background: linear-gradient(135deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.3) 100%);
    }

    .promo-btn:hover {
      background: rgba(0,0,0,0.6);
      border-color: #ffffff;
      transform: scale(1.05);
    }

    /* CAT√âGORIES HORIZONTALES */
    .categories-scroll {
      margin-top: 12px;
      padding: 8px 8px 4px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      position: sticky;
      top: calc(var(--header-height) + 80px);
      z-index: 980;
      background: var(--bg0);
    }

    .categories-scroll::-webkit-scrollbar {
      display: none;
    }

    .cat-scroll-container {
      display: flex;
      gap: 6px;
      min-width: max-content;
    }

    .cat-btn {
      flex: 0 0 auto;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 4px;
      min-height: 36px;
    }

    .cat-btn:hover {
      background: rgba(255,255,255,.1);
      border-color: var(--accent2);
    }

    .cat-btn.active {
      border-color: var(--accent);
      background: rgba(0, 255, 136, 0.15);
      color: var(--accent);
    }

    /* Style sp√©cial pour le bouton PROMOTIONS */
    .cat-btn.promo {
      background: linear-gradient(135deg, #ff0000, #ff6b00);
      color: #ffffff;
      border-color: #ff9900;
      font-weight: 900;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      animation: pulse 2s infinite;
    }

    .cat-btn.promo.active {
      background: linear-gradient(135deg, #ff4444, #ff9900);
      color: #ffffff;
      border-color: #ffcc00;
      box-shadow: 0 0 15px rgba(255, 107, 0, 0.7);
      transform: scale(1.05);
    }

    .cat-count {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0,0,0,.3);
      border: 1px solid rgba(255,255,255,.1);
    }

    /* CONTENU PRINCIPAL */
    .main-content {
      padding: 8px;
    }

    .content-header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px 8px;
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      margin-bottom: 12px;
    }

    .content-header h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 900;
      color: var(--accent);
    }

    .content-header .meta {
      margin: 2px 0 0;
      color: var(--muted);
      font-size: 11px;
    }

    /* SECTION TEXTE DYNAMIQUE POUR PROMOTIONS */
    .dynamic-promo-section {
      background: linear-gradient(135deg, #ff0000 0%, #ff6b00 50%, #ffd000 100%);
      border-radius: var(--radius);
      padding: 0;
      margin: 0 8px 10px;
      border: 2px solid #ff9900;
      box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4);
      overflow: hidden;
      display: none;
      position: relative;
      max-height: 150px;
      transition: max-height 0.3s ease;
    }

    .dynamic-promo-section.expanded {
      max-height: 400px;
    }

    .dynamic-promo-section.visible {
      display: block;
    }

    .dynamic-promo-header {
      background: rgba(0, 0, 0, 0.3);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      min-height: 44px;
    }

    .dynamic-promo-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 900;
      color: #ffffff;
      font-size: 13px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }

    .dynamic-promo-badge {
      background: #000000;
      color: #ffcc00;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 900;
      animation: pulse 1.5s infinite;
    }

    .dynamic-promo-content-wrapper {
      position: relative;
      padding-right: 10px;
    }

    .dynamic-promo-content {
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.2);
      max-height: 250px;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: #ff9900 rgba(0,0,0,0.2);
    }

    /* Scrollbar toujours visible */
    .dynamic-promo-content::-webkit-scrollbar {
      width: 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
      display: block !important;
    }

    .dynamic-promo-content::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
      display: block !important;
    }

    .dynamic-promo-content::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #ffcc00, #ff9900);
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.3);
      display: block !important;
      cursor: pointer;
    }

    .dynamic-promo-content::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #ffdd44, #ffaa00);
    }

    /* INDICATEUR DE SCROLL VISIBLE */
    .scroll-indicator {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.7);
      font-size: 24px;
      animation: bounce 2s infinite;
      pointer-events: none;
      z-index: 1;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(-50%); }
      50% { transform: translateY(-40%); }
    }

    .dynamic-promo-text {
      font-size: 13px;
      font-weight: 700;
      color: #ffffff;
      line-height: 1.4;
      white-space: pre-line;
      margin: 0;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      text-align: left;
      letter-spacing: 0.2px;
      padding-right: 10px;
    }

    .dynamic-promo-text .promo-percent {
      color: #ffcc00;
      font-weight: 900;
      background: rgba(0,0,0,0.3);
      padding: 1px 4px;
      border-radius: 4px;
      margin: 0 2px;
      display: inline-block;
      font-size: 12px;
    }

    /* BOUTONS TOUJOURS VISIBLES */
    .dynamic-promo-controls {
      display: flex;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.4);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .dynamic-promo-toggle {
      flex: 1;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
      color: white;
      cursor: pointer;
      font-weight: 700;
      font-size: 11px;
      transition: all 0.2s ease;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .dynamic-promo-toggle:hover {
      background: rgba(255,255,255,0.2);
    }

    .dynamic-promo-toggle.hide {
      background: rgba(255,107,107,0.2);
      border-color: rgba(255,107,107,0.5);
    }

    .dynamic-promo-toggle.hide:hover {
      background: rgba(255,107,107,0.3);
    }

    /* Boutons admin */
    .admin-controls {
      display: flex;
      gap: 6px;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .dynamic-promo-btn {
      flex: 1;
      padding: 6px 10px;
      border-radius: 6px;
      border: 2px solid;
      cursor: pointer;
      font-weight: 700;
      font-size: 11px;
      transition: all 0.2s ease;
      text-align: center;
    }

    .dynamic-promo-btn.edit {
      border-color: #00ff88;
      background: linear-gradient(135deg, #00ff88, #00cc66);
      color: #000000;
    }

    .dynamic-promo-btn.edit:hover {
      background: linear-gradient(135deg, #00ffaa, #00ee77);
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,255,136,0.3);
    }

    .dynamic-promo-btn.clear {
      border-color: #ff6b6b;
      background: linear-gradient(135deg, #ff6b6b, #ff4444);
      color: #000000;
    }

    .dynamic-promo-btn.clear:hover {
      background: linear-gradient(135deg, #ff8888, #ff5555);
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(255,107,107,0.3);
    }

    /* SECTION ADMIN DANS LE PANIER */
    .admin-section {
      background: var(--card2);
      border-radius: var(--radius);
      border: 2px solid var(--warning);
      padding: 15px;
      box-shadow: var(--shadow);
      margin-bottom: 15px;
      display: none;
    }

    .admin-section.visible {
      display: block;
    }

    .admin-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--warning);
    }

    .admin-header h4 {
      margin: 0;
      font-size: 14px;
      color: var(--warning);
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .admin-badge {
      background: rgba(255, 167, 38, 0.2);
      color: var(--warning);
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 900;
    }

    .admin-controls-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 10px;
    }

    .admin-btn {
      padding: 10px;
      border-radius: 8px;
      border: 2px solid;
      background: rgba(255,255,255,0.1);
      color: var(--text);
      cursor: pointer;
      font-weight: 700;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      transition: all 0.2s ease;
      text-align: center;
      min-height: 70px;
    }

    .admin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .admin-btn.promo {
      border-color: var(--accent);
      background: rgba(0, 255, 136, 0.1);
      color: var(--accent);
    }

    .admin-btn.stock {
      border-color: var(--accent2);
      background: rgba(0, 212, 255, 0.1);
      color: var(--accent2);
    }

    .admin-btn.stats {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
      color: #ff6b6b;
    }

    .admin-btn.settings {
      border-color: #ffa726;
      background: rgba(255, 167, 38, 0.1);
      color: #ffa726;
    }

    .admin-icon {
      font-size: 20px;
    }

    .admin-label {
      font-size: 10px;
      font-weight: 900;
    }

    /* PAGINATION EN HAUT */
    .pagination-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      color: var(--muted);
      font-size: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .page-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .page-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.08);
      color: var(--text);
      cursor: pointer;
      font-weight: 900;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .page-btn:hover {
      background: rgba(255,255,255,.15);
      border-color: var(--accent);
    }

    .page-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .page-info {
      font-size: 12px;
      font-weight: 600;
      min-width: 80px;
      text-align: center;
    }

    .page-count {
      font-size: 11px;
      color: var(--muted);
    }

    /* PAGINATION EN BAS */
    .pagination-bottom {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px 0 50px;
      color: var(--muted);
      font-size: 14px;
      gap: 20px;
      margin-top: 20px;
    }

    .pagination-bottom .page-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid var(--accent);
      background: rgba(0, 255, 136, 0.15);
      color: var(--accent);
      cursor: pointer;
      font-weight: 900;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,255,136,0.2);
    }

    .pagination-bottom .page-btn:hover {
      background: rgba(0, 255, 136, 0.25);
      border-color: var(--accent2);
      transform: translateY(-3px) scale(1.1);
      box-shadow: 0 8px 25px rgba(0,255,136,0.3);
    }

    .pagination-bottom .page-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      border-color: var(--muted);
      background: rgba(255,255,255,0.1);
      color: var(--muted);
      transform: none;
      box-shadow: none;
    }

    .pagination-bottom .page-info {
      font-size: 18px;
      font-weight: 900;
      min-width: 140px;
      text-align: center;
      background: rgba(255,255,255,.05);
      padding: 12px 24px;
      border-radius: 12px;
      border: 2px solid var(--line);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* GRID PRODUITS */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 8px 0 20px;
    }

    @media (min-width: 480px) {
      .products-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
      }
    }

    @media (min-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }
    }

    @media (min-width: 1024px) {
      .products-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: 18px;
      }
    }

    /* CARTE PRODUIT */
    .product-card {
      border-radius: 10px;
      border: 1px solid var(--line);
      background: var(--card2);
      padding: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,.2);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      gap: 6px;
      height: 100%;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .product-card:hover {
      border-color: var(--accent2);
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,212,255,0.15);
    }

    .product-card.promo-card {
      border: 2px solid #ff9900;
      background: linear-gradient(135deg, var(--card2) 0%, #1a1a2e 100%);
      box-shadow: 0 4px 12px rgba(255, 107, 0, 0.2);
    }

    .product-card.promo-card:hover {
      border-color: #ffcc00;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 107, 0, 0.3);
    }

    .product-image {
      width: 100%;
      height: 120px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, #1a365d 0%, #112240 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      padding: 6px;
    }

    .product-card.promo-card .product-image {
      border: 1px solid rgba(255, 153, 0, 0.3);
      background: linear-gradient(135deg, #0a1929 0%, #1a1a2e 100%);
    }

    .product-image img {
      max-width: 90%;
      max-height: 90%;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
      transition: transform 0.3s ease;
    }

    .product-card:hover .product-image img {
      transform: scale(1.05);
    }

    .no-photo {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-weight: 800;
      font-size: 11px;
      background: linear-gradient(135deg, var(--card) 0%, var(--card2) 100%);
      text-align: center;
      padding: 15px;
    }

    /* BADGE PROMO SUR L'IMAGE */
    .image-promo-badge {
      position: absolute;
      top: 6px;
      right: 6px;
      background: linear-gradient(135deg, #ff0000 0%, #ff6b00 100%);
      color: white;
      font-weight: 900;
      font-size: 10px;
      padding: 3px 6px;
      border-radius: 15px;
      z-index: 2;
      border: 1px solid rgba(255,255,255,0.5);
      box-shadow: 0 2px 6px rgba(255, 107, 0, 0.5);
      animation: pulse 1.5s infinite;
      transform: rotate(5deg);
    }

    .product-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-height: 0;
    }

    .product-name {
      font-weight: 900;
      font-size: 12px;
      line-height: 1.3;
      min-width: 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      color: var(--text);
    }

    .product-price {
      font-weight: 900;
      padding: 5px 8px;
      border-radius: 999px;
      border: 2px solid var(--accent);
      background: rgba(0, 255, 136, 0.1);
      color: var(--accent);
      font-size: 12px;
      white-space: nowrap;
      text-align: center;
      margin-top: auto;
    }

    .product-card.promo-card .product-price {
      border: 2px solid #ff9900;
      background: rgba(255, 153, 0, 0.15);
      color: #ffcc00;
    }

    .product-old-price {
      font-size: 9px;
      color: var(--muted);
      text-decoration: line-through;
      margin-right: 3px;
    }

    .product-card.promo-card .product-old-price {
      color: #ff8888;
    }

    .product-discount {
      position: absolute;
      top: 8px;
      right: 8px;
      background: linear-gradient(135deg, #ff0000, #ff6b00);
      color: white;
      font-weight: 900;
      font-size: 9px;
      padding: 2px 5px;
      border-radius: 4px;
      z-index: 2;
      border: 1px solid rgba(255,255,255,0.3);
      box-shadow: 0 2px 6px rgba(255, 0, 0, 0.3);
    }

    .product-meta {
      color: var(--muted);
      font-size: 9px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .product-stock-tag {
      padding: 3px 6px;
      border-radius: 999px;
      font-size: 9px;
      border: 1px solid rgba(255,255,255,.1);
      background: rgba(0,0,0,.2);
      color: rgba(255,255,255,.9);
      font-weight: 700;
      text-align: center;
      align-self: flex-start;
      margin-top: 3px;
    }

    .product-stock-tag.ok {
      border-color: rgba(0,255,136,.3);
      color: var(--accent);
      background: rgba(0,255,136,.08);
    }

    .product-stock-tag.no {
      border-color: rgba(255,107,107,.4);
      color: var(--danger);
      background: rgba(255,107,107,.08);
    }

    /* SECTION ARTICLES SIMILAIRES */
    .similar-products-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid var(--accent2);
    }

    .similar-products-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .similar-products-header h4 {
      margin: 0;
      font-size: 16px;
      color: var(--accent2);
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .similar-products-count {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 212, 255, 0.1);
      color: var(--accent2);
      font-weight: 700;
    }

    .similar-products-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 8px 0;
    }

    @media (min-width: 768px) {
      .similar-products-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .similar-products-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .similar-product-card {
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(26, 54, 93, 0.5);
      padding: 8px;
      transition: all 0.2s ease;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .similar-product-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,255,136,0.1);
    }

    .similar-product-image {
      width: 100%;
      height: 70px;
      border-radius: 6px;
      background: linear-gradient(135deg, #1a365d 0%, #112240 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    .similar-product-image img {
      max-width: 80%;
      max-height: 80%;
      width: auto;
      height: auto;
      object-fit: contain;
    }

    .similar-product-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .similar-product-name {
      font-weight: 700;
      font-size: 10px;
      line-height: 1.2;
      color: var(--text);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .similar-product-price {
      font-weight: 900;
      font-size: 11px;
      color: var(--accent);
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background: rgba(0, 255, 136, 0.05);
      text-align: center;
      margin-top: auto;
    }

    .similar-product-stock {
      font-size: 8px;
      padding: 2px 5px;
      border-radius: 999px;
      background: rgba(0,255,136,0.1);
      color: var(--accent);
      border: 1px solid rgba(0,255,136,0.3);
      text-align: center;
      font-weight: 700;
    }

    .similar-product-stock.out {
      background: rgba(255,107,107,0.1);
      color: var(--danger);
      border-color: rgba(255,107,107,0.3);
    }

    /* BOUTON ADMIN SECRET */
    .secret-admin-btn {
      position: fixed;
      bottom: 150px;
      right: 15px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255,167,38,0.2);
      border: 2px solid var(--warning);
      color: var(--warning);
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      box-shadow: 0 4px 15px rgba(255, 167, 38, 0.3);
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .secret-admin-btn:hover {
      background: rgba(255,167,38,0.3);
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 167, 38, 0.4);
    }

    /* ANIMATIONS */
    @keyframes scrollHorizontal {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    @keyframes pulse {
      0%, 100% { 
        transform: scale(1); 
        box-shadow: 0 5px 25px rgba(255, 107, 0, 0.3);
      }
      50% { 
        transform: scale(1.02); 
        box-shadow: 0 8px 30px rgba(255, 107, 0, 0.5);
      }
    }

    /* RESPONSIVE ADJUSTMENTS */
    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      
      .similar-products-grid {
        grid-template-columns: repeat(1, 1fr);
      }
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- HEADER FIXE -->
    <header class="header">
      <div class="logo-brand">
        <div class="logo">
          <img src="logo-maxi-jdc-market.jpg" alt="MAXI JDC MARKET" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDQiIGhlaWdodD0iNDQiIHZpZXdCb3g9IjAgMCA0NCA0NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDQiIGhlaWdodD0iNDQiIHJ4PSIxMCIgZmlsbD0iIzBhMTkyOSIvPjxwYXRoIGQ9Ik0xMSAyM0gyM1YzMUgxMVYyM1oiIGZpbGw9IiMwMGZmODgiLz48cGF0aCBkPSJNMjIgMTFIMzRWMjJIMjJWMTFaIiBmaWxsPSIjMDBkNGZmIi8+PC9zdmc+'">
        </div>
        <div class="brand-text">
          <h1>MAXI JDC MARKET</h1>
          <p>Des prix mini ‚Äî Un MAXI choix</p>
        </div>
      </div>
      
      <button class="cart-btn-header" id="cartTopBtn" title="Ouvrir le panier">
        <span class="icon">üõí</span>
        <span class="count" id="cartTopCount">0</span>
      </button>
    </header>

    <!-- ZONE RECHERCHE -->
    <div class="search-section">
      <div class="search-container">
        <div class="search-input">
          <input id="searchInput" type="search" placeholder="üîç Rechercher un produit..." autocomplete="off">
          <button class="search-enter-btn" id="searchEnterBtn" title="Rechercher">‚Üµ</button>
        </div>
        <div class="search-buttons">
          <button class="search-btn" id="clearSearchBtn">Effacer</button>
          <button class="search-btn green" id="showAllBtn">Tous</button>
        </div>
      </div>
    </div>

    <!-- INFO BAR DYNAMIQUE HORIZONTALE -->
    <div class="info-bar">
      <div class="info-bar-container">
        <div class="info-bar-item">üìç Jardins de Carthage</div>
        <div class="info-bar-item">üïí 7am ‚Äì 1am</div>
        <div class="info-bar-item"><strong>WhatsApp:</strong> +216 25 600 978</div>
        <div class="info-bar-item qr-item" id="qrInfoBtn" title="Scanner le QR Code">üì± QR Code</div>
        
        <!-- Doubler pour effet de boucle -->
        <div class="info-bar-item">üìç Jardins de Carthage</div>
        <div class="info-bar-item">üïí 7am ‚Äì 1am</div>
        <div class="info-bar-item"><strong>WhatsApp:</strong> +216 25 600 978</div>
        <div class="info-bar-item qr-item" title="Scanner le QR Code">üì± QR Code</div>
      </div>
    </div>

    <!-- BANNI√àRE PROMOTIONNELLE -->
    <div class="promo-banner" id="promoBanner">
      <div class="promo-content">
        <div class="promo-icon">üî•</div>
        <div class="promo-text">
          <h4 id="promoTitle">üî• PROMOTIONS</h4>
          <p id="promoDesc">Profitez de nos offres sp√©ciales !</p>
        </div>
      </div>
      <button class="promo-btn" id="viewPromosBtn">VOIR ‚Üí</button>
    </div>

    <!-- CAT√âGORIES -->
    <div class="categories-scroll">
      <div class="cat-scroll-container" id="categoriesContainer">
        <!-- Les cat√©gories seront g√©n√©r√©es ici -->
      </div>
    </div>

    <!-- SECTION TEXTE DYNAMIQUE -->
    <div class="dynamic-promo-section" id="dynamicPromoSection">
      <div class="dynamic-promo-header">
        <div class="dynamic-promo-title">
          üì¢ Offres promotionnelles
          <span class="dynamic-promo-badge">MAXI JDC MARKET</span>
        </div>
      </div>
      
      <div class="dynamic-promo-content-wrapper">
        <div class="dynamic-promo-content">
          <div class="scroll-indicator">‚ñº</div>
          <p class="dynamic-promo-text" id="dynamicPromoText">
            üéâ Bienvenue chez MAXI JDC MARKET ! üéâ<br>
            D√©couvrez nos meilleures offres du moment.<br>
            Livraison rapide et service de qualit√©.
          </p>
        </div>
      </div>
      
      <div class="dynamic-promo-controls">
        <button class="dynamic-promo-toggle" id="togglePromoTextBtn">
          üîΩ Voir plus
        </button>
        <button class="dynamic-promo-toggle hide" id="hidePromoBtn">
          üó®Ô∏è Masquer
        </button>
      </div>
      
      <!-- SECTION ADMIN -->
      <div class="admin-controls" id="adminControls" style="display:none;">
        <button class="dynamic-promo-btn edit" id="editDynamicTextBtn">
          ‚úèÔ∏è Modifier
        </button>
        <button class="dynamic-promo-btn clear" id="clearDynamicTextBtn">
          üóëÔ∏è Effacer
        </button>
      </div>
    </div>

    <!-- CONTENU PRINCIPAL -->
    <main class="wrap">
      <div class="main-content">
        <div class="content-header">
          <h2 id="activeCategoryLabel">üî• PROMOTIONS</h2>
          <div class="meta" id="activeCategoryMeta">Chargement...</div>
          
          <!-- PAGINATION EN HAUT -->
          <div class="pagination-top">
            <div class="page-controls">
              <button class="page-btn" id="prevPageBtn" title="Page pr√©c√©dente">‚Äπ</button>
              <span class="page-info" id="pageInfo">Page 1/1</span>
              <button class="page-btn" id="nextPageBtn" title="Page suivante">‚Ä∫</button>
            </div>
            <div class="page-count" id="itemCount">0 article(s)</div>
          </div>
        </div>

        <!-- GRID PRODUITS -->
        <div class="products-grid" id="productsGrid">
          <!-- Les produits seront g√©n√©r√©s ici -->
        </div>

        <!-- PAGINATION EN BAS -->
        <div class="pagination-bottom" id="paginationBottom">
          <button class="page-btn" id="prevPageBottomBtn" title="Page pr√©c√©dente">‚Äπ</button>
          <span class="page-info" id="pageInfoBottom">Page 1/1</span>
          <button class="page-btn" id="nextPageBottomBtn" title="Page suivante">‚Ä∫</button>
        </div>
      </div>
    </main>
    
    <!-- BOUTON ADMIN SECRET -->
    <button class="secret-admin-btn" id="secretAdminBtn" title="Activer/D√©sactiver mode admin">üîì</button>
  </div>

<script>
// ===================== CONFIGURATION =====================
const CONFIG = {
  minOrder: 15,
  freeShipping: 100,
  shippingFee: 3,
  whatsappNumber: "21625600978",
  itemsPerPage: 24,
  localStorageKey: 'maxi_jdc_market_app',
  imagesBasePath: 'images/products/',
  adminPassword: "admin123"
};

// Cat√©gories avec donn√©es de test
const CATEGORIES = [
  { key: "promotions", label: "üî• PROMOTIONS", isPromo: true },
  { key: "cafe", label: "‚òï Caf√© & Th√©s" },
  { key: "chips_snacks", label: "ü•î Chips & Snacks" },
  { key: "chocolats_biscuits", label: "üç´ Chocolats & Biscuits" },
  { key: "eaux", label: "üíß Eaux & Boissons" },
  { key: "jus_boissons", label: "üßÉ Jus & Boissons" },
  { key: "produits_laitiers", label: "ü•õ Produits Laitiers" },
  { key: "fruits_secs", label: "üå∞ Fruits Secs" },
  { key: "hygiene", label: "üßº Hygi√®ne" },
  { key: "animaux", label: "üê∂ Animaux" }
];

// Donn√©es de test pour les produits
const TEST_PRODUCTS = {
  promotions: [
    { code: "PROMO001", name: "CRUNCHIES PAPRIKA", price: 0.50, oldPrice: 1.00, category: "üî• PROMOTIONS", isPromotion: true },
    { code: "PROMO002", name: "CRUNCHIES CHEESE", price: 0.50, oldPrice: 1.00, category: "üî• PROMOTIONS", isPromotion: true },
    { code: "PROMO003", name: "CIUFFI CHIEN STRIP POLLO", price: 6.00, oldPrice: 8.50, category: "üî• PROMOTIONS", isPromotion: true }
  ],
  cafe: [
    { code: "CAFE001", name: "CAF√â GOLDEN EXTREME 10 CAPSULES", price: 12.50, category: "‚òï Caf√© & Th√©s" },
    { code: "CAFE002", name: "CAF√â ARABICA 250G", price: 8.75, category: "‚òï Caf√© & Th√©s" },
    { code: "CAFE003", name: "TH√â VERT 100G", price: 6.25, category: "‚òï Caf√© & Th√©s" }
  ],
  chips_snacks: [
    { code: "CHIPS001", name: "CHIPS LAYS SEL 80GR", price: 2.50, category: "ü•î Chips & Snacks" },
    { code: "CHIPS002", name: "CHIPS DORITOS NACHO", price: 3.00, category: "ü•î Chips & Snacks" },
    { code: "CHIPS003", name: "CACAHU√àTES GRILL√âES", price: 4.50, category: "ü•î Chips & Snacks" }
  ],
  chocolats_biscuits: [
    { code: "CHOCO001", name: "CHOCOLAT MILKA", price: 3.75, category: "üç´ Chocolats & Biscuits" },
    { code: "CHOCO002", name: "BISCUITS LU", price: 5.25, category: "üç´ Chocolats & Biscuits" },
    { code: "CHOCO003", name: "CHOCOLAT NOIR 70%", price: 4.50, category: "üç´ Chocolats & Biscuits" }
  ],
  eaux: [
    { code: "EAU001", name: "EAU MIN√âRALE 1.5L", price: 1.20, category: "üíß Eaux & Boissons" },
    { code: "EAU002", name: "EAU GAZEUSE", price: 1.50, category: "üíß Eaux & Boissons" },
    { code: "EAU003", name: "EAU DE SOURCE", price: 1.00, category: "üíß Eaux & Boissons" }
  ],
  jus_boissons: [
    { code: "JUS001", name: "JUS D'ORANGE 1L", price: 3.50, category: "üßÉ Jus & Boissons" },
    { code: "JUS002", name: "JUS DE POMME", price: 3.25, category: "üßÉ Jus & Boissons" },
    { code: "JUS003", name: "BOISSON √âNERGISANTE", price: 4.00, category: "üßÉ Jus & Boissons" }
  ],
  produits_laitiers: [
    { code: "LAIT001", name: "LAIT ENTIER 1L", price: 2.80, category: "ü•õ Produits Laitiers" },
    { code: "LAIT002", name: "YAOURT NATURE", price: 1.20, category: "ü•õ Produits Laitiers" },
    { code: "LAIT003", name: "FROMAGE BLANC", price: 2.50, category: "ü•õ Produits Laitiers" }
  ],
  fruits_secs: [
    { code: "FRUIT001", name: "AMANDES 200G", price: 8.50, category: "üå∞ Fruits Secs" },
    { code: "FRUIT002", name: "NOIX DE CAJOU", price: 9.00, category: "üå∞ Fruits Secs" },
    { code: "FRUIT003", name: "RAISINS SECS", price: 5.50, category: "üå∞ Fruits Secs" }
  ],
  hygiene: [
    { code: "HYG001", name: "SHAMPOOING", price: 7.50, category: "üßº Hygi√®ne" },
    { code: "HYG002", name: "DENTIFRICE", price: 3.25, category: "üßº Hygi√®ne" },
    { code: "HYG003", name: "GEL DOUCHE", price: 6.80, category: "üßº Hygi√®ne" }
  ],
  animaux: [
    { code: "ANIM001", name: "CROQUETTES CHIEN", price: 15.00, category: "üê∂ Animaux" },
    { code: "ANIM002", name: "CROQUETTES CHAT", price: 12.50, category: "üê∂ Animaux" },
    { code: "ANIM003", name: "LITI√àRE", price: 8.00, category: "üê∂ Animaux" }
  ]
};

// ===================== √âTAT GLOBAL =====================
const state = {
  user: null,
  products: new Map(),
  cart: {},
  searchQuery: '',
  activeCategory: 'promotions',
  showAllCategories: false,
  currentPage: 1,
  isAdmin: false,
  dynamicText: "üéâ Bienvenue chez MAXI JDC MARKET ! üéâ<br>D√©couvrez nos meilleures offres du moment.<br>Livraison rapide et service de qualit√©."
};

// ===================== UTILITAIRES =====================
function $(id) { return document.getElementById(id); }

function formatPrice(amount) {
  return Number(amount).toFixed(2).replace('.', ',') + ' dt';
}

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <span>${type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ùå'}</span>
    <span>${message}</span>
  `;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.remove();
  }, 3000);
}

// ===================== INITIALISATION =====================
function init() {
  loadProducts();
  renderCategories();
  renderProducts();
  updateCartUI();
  
  // √âv√©nements
  initEventListeners();
  
  showToast('üëã Bienvenue chez MAXI JDC MARKET !');
}

function loadProducts() {
  // Charger les produits de test
  for (const [categoryKey, products] of Object.entries(TEST_PRODUCTS)) {
    state.products.set(categoryKey, products.map(product => ({
      ...product,
      categoryKey
    })));
  }
}

// ===================== RENDU CAT√âGORIES =====================
function renderCategories() {
  const container = $('categoriesContainer');
  container.innerHTML = '';
  
  // Bouton "Tous"
  const allButton = document.createElement('button');
  allButton.className = `cat-btn ${state.showAllCategories ? 'active' : ''}`;
  const allProductsCount = [...state.products.values()].flat().length;
  allButton.innerHTML = `üåê Tous <span class="cat-count">${allProductsCount}</span>`;
  allButton.onclick = () => {
    state.showAllCategories = true;
    state.activeCategory = null;
    state.currentPage = 1;
    renderProducts();
    updateCategoriesUI();
  };
  container.appendChild(allButton);
  
  // Boutons des cat√©gories
  CATEGORIES.forEach(category => {
    const products = state.products.get(category.key) || [];
    const button = document.createElement('button');
    button.className = `cat-btn ${category.isPromo ? 'promo' : ''} ${
      !state.showAllCategories && state.activeCategory === category.key ? 'active' : ''
    }`;
    
    button.innerHTML = `${category.label} <span class="cat-count">${products.length}</span>`;
    button.onclick = () => {
      state.showAllCategories = false;
      state.activeCategory = category.key;
      state.currentPage = 1;
      renderProducts();
      updateCategoriesUI();
    };
    container.appendChild(button);
  });
}

function updateCategoriesUI() {
  const buttons = $('categoriesContainer').querySelectorAll('.cat-btn');
  buttons.forEach(button => {
    button.classList.remove('active');
  });
  
  if (state.showAllCategories) {
    buttons[0].classList.add('active');
    $('activeCategoryLabel').textContent = 'Tous les produits';
    $('activeCategoryMeta').textContent = 'Toutes cat√©gories';
  } else {
    const category = CATEGORIES.find(c => c.key === state.activeCategory);
    if (category) {
      const index = CATEGORIES.findIndex(c => c.key === state.activeCategory) + 1;
      if (buttons[index]) {
        buttons[index].classList.add('active');
      }
      $('activeCategoryLabel').textContent = category.label;
      $('activeCategoryMeta').textContent = `${category.key}.csv`;
    }
  }
}

// ===================== RENDU PRODUITS =====================
function getFilteredProducts() {
  let products = [];
  
  if (state.showAllCategories) {
    // Tous les produits
    products = [...state.products.values()].flat();
  } else {
    // Produits de la cat√©gorie active
    products = state.products.get(state.activeCategory) || [];
  }
  
  // Filtrage par recherche
  if (state.searchQuery) {
    const query = state.searchQuery.toLowerCase();
    products = products.filter(product =>
      product.name.toLowerCase().includes(query) ||
      product.code.toLowerCase().includes(query)
    );
  }
  
  return products;
}

function renderProducts() {
  const products = getFilteredProducts();
  const totalPages = Math.ceil(products.length / CONFIG.itemsPerPage) || 1;
  
  if (state.currentPage > totalPages) {
    state.currentPage = totalPages || 1;
  }
  
  // Mettre √† jour la pagination
  $('pageInfo').textContent = `Page ${state.currentPage}/${totalPages}`;
  $('pageInfoBottom').textContent = `Page ${state.currentPage}/${totalPages}`;
  $('itemCount').textContent = `${products.length} article(s)`;
  
  $('prevPageBtn').disabled = state.currentPage === 1;
  $('nextPageBtn').disabled = state.currentPage === totalPages;
  $('prevPageBottomBtn').disabled = state.currentPage === 1;
  $('nextPageBottomBtn').disabled = state.currentPage === totalPages;
  
  // Afficher/masquer la pagination basse
  $('paginationBottom').style.display = totalPages > 1 ? 'flex' : 'none';
  
  // Produits √† afficher sur la page courante
  const startIndex = (state.currentPage - 1) * CONFIG.itemsPerPage;
  const endIndex = startIndex + CONFIG.itemsPerPage;
  const productsToShow = products.slice(startIndex, endIndex);
  
  const grid = $('productsGrid');
  grid.innerHTML = '';
  
  if (productsToShow.length === 0) {
    grid.innerHTML = `
      <div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted);">
        <div style="font-size:48px;margin-bottom:15px;">üîç</div>
        <h3 style="margin-bottom:10px;color:var(--text);">Aucun produit trouv√©</h3>
        <p>Essayez de modifier votre recherche ou s√©lectionnez une autre cat√©gorie</p>
      </div>
    `;
    return;
  }
  
  // Afficher les produits
  productsToShow.forEach(product => {
    const card = document.createElement('div');
    card.className = `product-card ${product.isPromotion ? 'promo-card' : ''}`;
    
    // Badge de promotion
    const discountBadge = product.isPromotion && product.oldPrice 
      ? `<div class="image-promo-badge">-${Math.round((1 - product.price / product.oldPrice) * 100)}%</div>`
      : '';
    
    // Ancien prix si promotion
    const oldPriceDisplay = product.isPromotion && product.oldPrice 
      ? `<div class="product-old-price">${formatPrice(product.oldPrice)}</div>`
      : '';
    
    // Image du produit
    const imageSrc = `${CONFIG.imagesBasePath}${product.code}.jpg`;
    
    card.innerHTML = `
      <div class="product-image">
        <img src="${imageSrc}" 
             alt="${product.name}"
             onload="this.style.display='block'; this.parentElement.querySelector('.no-photo').style.display='none';"
             onerror="this.style.display='none'; this.parentElement.querySelector('.no-photo').style.display='flex';">
        <div class="no-photo" style="display:none;">${product.code}</div>
        ${discountBadge}
      </div>
      
      <div class="product-info">
        <div class="product-name">${product.name}</div>
        <div class="product-meta">
          <div>Code: ${product.code}</div>
          <div>${product.category}</div>
        </div>
        <div class="product-price">
          ${oldPriceDisplay}
          ${formatPrice(product.price)}
        </div>
      </div>
      
      <div class="product-stock-tag ok">
        ‚úì En stock
      </div>
    `;
    
    card.addEventListener('click', () => {
      showProductDetails(product);
    });
    
    grid.appendChild(card);
  });
}

// ===================== GESTION PANIER =====================
function updateCartUI() {
  const cartCount = Object.values(state.cart).reduce((sum, item) => sum + item.quantity, 0);
  $('cartTopCount').textContent = cartCount;
}

function addToCart(product) {
  if (!state.cart[product.code]) {
    state.cart[product.code] = {
      ...product,
      quantity: 1
    };
  } else {
    state.cart[product.code].quantity++;
  }
  
  updateCartUI();
  showToast(`‚úÖ ${product.name} ajout√© au panier !`);
}

// ===================== GESTION ADMIN =====================
function toggleAdminMode() {
  if (state.isAdmin) {
    state.isAdmin = false;
    $('adminControls').style.display = 'none';
    showToast('üîê Mode administrateur d√©sactiv√©', 'warning');
  } else {
    const password = prompt("Entrez le mot de passe administrateur:");
    if (password === CONFIG.adminPassword) {
      state.isAdmin = true;
      $('adminControls').style.display = 'flex';
      showToast('üîì Mode administrateur activ√©', 'success');
    } else {
      showToast('‚ùå Mot de passe incorrect', 'error');
    }
  }
}

function togglePromoText() {
  const section = $('dynamicPromoSection');
  const btn = $('togglePromoTextBtn');
  
  if (section.classList.contains('expanded')) {
    section.classList.remove('expanded');
    btn.innerHTML = 'üîΩ Voir plus';
  } else {
    section.classList.add('expanded');
    btn.innerHTML = 'üîº R√©duire';
  }
}

function hidePromoSection() {
  $('dynamicPromoSection').classList.remove('visible');
  showToast('üì¢ Section promotions masqu√©e', 'warning');
}

function editDynamicText() {
  if (!state.isAdmin) {
    showToast('‚ùå Acc√®s r√©serv√© √† l\'administrateur', 'error');
    return;
  }
  
  const newText = prompt("Modifier le texte promotionnel:", 
    state.dynamicText.replace(/<br>/g, '\n').replace(/<[^>]*>/g, ''));
  
  if (newText !== null) {
    state.dynamicText = newText.replace(/\n/g, '<br>');
    $('dynamicPromoText').innerHTML = state.dynamicText;
    showToast('‚úÖ Texte mis √† jour');
  }
}

function clearDynamicText() {
  if (!state.isAdmin) {
    showToast('‚ùå Acc√®s r√©serv√© √† l\'administrateur', 'error');
    return;
  }
  
  if (confirm('Voulez-vous vraiment effacer le texte promotionnel ?')) {
    state.dynamicText = '';
    $('dynamicPromoText').textContent = '';
    showToast('Texte effac√©', 'warning');
  }
}

// ===================== NAVIGATION =====================
function navigateToPrevPage() {
  if (state.currentPage > 1) {
    state.currentPage--;
    renderProducts();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}

function navigateToNextPage() {
  const products = getFilteredProducts();
  const totalPages = Math.ceil(products.length / CONFIG.itemsPerPage) || 1;
  
  if (state.currentPage < totalPages) {
    state.currentPage++;
    renderProducts();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}

// ===================== FONCTIONS UTILITAIRES =====================
function showProductDetails(product) {
  let details = `=== ${product.name} ===\n\n`;
  details += `Code: ${product.code}\n`;
  details += `Cat√©gorie: ${product.category}\n`;
  details += `Prix: ${formatPrice(product.price)}\n`;
  
  if (product.oldPrice) {
    const discount = Math.round((1 - product.price / product.oldPrice) * 100);
    details += `Ancien prix: ${formatPrice(product.oldPrice)} (-${discount}%)\n`;
  }
  
  if (confirm(`${details}\n\nAjouter au panier ?`)) {
    addToCart(product);
  }
}

function showAllProducts() {
  state.showAllCategories = true;
  state.activeCategory = null;
  state.currentPage = 1;
  renderProducts();
  updateCategoriesUI();
}

function viewPromotions() {
  state.showAllCategories = false;
  state.activeCategory = 'promotions';
  state.currentPage = 1;
  renderProducts();
  updateCategoriesUI();
}

// ===================== GESTION DES √âV√âNEMENTS =====================
function initEventListeners() {
  // Recherche
  $('searchInput').addEventListener('input', (e) => {
    state.searchQuery = e.target.value;
    state.currentPage = 1;
    renderProducts();
  });
  
  $('searchEnterBtn').onclick = () => {
    state.currentPage = 1;
    renderProducts();
    $('searchInput').focus();
  };
  
  $('clearSearchBtn').onclick = () => {
    $('searchInput').value = '';
    state.searchQuery = '';
    state.currentPage = 1;
    renderProducts();
    $('searchInput').focus();
  };
  
  $('showAllBtn').onclick = showAllProducts;
  
  // Promotions
  $('viewPromosBtn').onclick = viewPromotions;
  
  // Pagination
  $('prevPageBtn').onclick = navigateToPrevPage;
  $('nextPageBtn').onclick = navigateToNextPage;
  $('prevPageBottomBtn').onclick = navigateToPrevPage;
  $('nextPageBottomBtn').onclick = navigateToNextPage;
  
  // Texte dynamique
  $('togglePromoTextBtn').onclick = togglePromoText;
  $('hidePromoBtn').onclick = hidePromoSection;
  $('editDynamicTextBtn').onclick = editDynamicText;
  $('clearDynamicTextBtn').onclick = clearDynamicText;
  
  // Admin
  $('secretAdminBtn').onclick = toggleAdminMode;
  
  // QR Code
  $('qrInfoBtn').onclick = () => {
    showToast('üì± Fonctionnalit√© QR Code √† venir', 'info');
  };
}

// ===================== D√âMARRAGE =====================
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
