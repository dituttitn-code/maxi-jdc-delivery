<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAXI JDC MARKET - Accueil</title>
    <style>
        :root {
            --primary: #0a1929;
            --secondary: #00ff88;
            --accent: #00d4ff;
            --light: #f0f6fc;
            --dark: #1a365d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, var(--primary) 0%, #112240 100%); color: var(--light); min-height: 100vh; }
        .header { background: rgba(10, 25, 47, 0.95); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--secondary); position: sticky; top: 0; z-index: 1000; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo h1 { font-size: 20px; background: linear-gradient(90deg, var(--secondary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav a { color: var(--light); text-decoration: none; margin-left: 20px; padding: 8px 15px; border-radius: 6px; transition: 0.3s; }
        .nav a:hover { background: rgba(0, 255, 136, 0.1); }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        .product-card { background: var(--dark); border-radius: 10px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; cursor: pointer; }
        .product-card:hover { border-color: var(--accent); transform: translateY(-5px); }
        .product-price { color: var(--secondary); font-weight: bold; font-size: 18px; margin: 10px 0; }
        .btn { background: var(--secondary); color: var(--primary); border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { opacity: 0.9; }
        .panier-sidebar { position: fixed; top: 0; right: -400px; width: 380px; height: 100vh; background: var(--dark); padding: 20px; transition: 0.5s; z-index: 2000; overflow-y: auto; border-left: 2px solid var(--secondary); }
        .panier-sidebar.open { right: 0; }
        .panier-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .total { font-size: 24px; color: var(--secondary); font-weight: bold; margin: 20px 0; }
        .btn-commander { background: var(--accent); width: 100%; padding: 15px; font-size: 18px; margin-top: 20px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1500; align-items: center; justify-content: center; }
        .modal-commande { background: var(--dark); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; border: 2px solid var(--secondary); }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo">
            <img src="logo-maxi-jdc-market.jpg" alt="Logo" width="40">
            <h1>MAXI JDC MARKET</h1>
        </div>
        <nav class="nav">
            <a href="tableau-de-bord.html">üìä Tableau de Bord</a>
            <a href="suivi-commandes.html">üìã Suivi Commandes</a>
            <a href="#" id="btnOpenPanier">üõí Panier (<span id="cartCount">0</span>)</a>
        </nav>
    </header>

    <!-- CONTENU PRINCIPAL -->
    <div class="container">
        <h2 style="margin: 20px 0;">Nos Produits</h2>
        <div class="products-grid" id="productsGrid">
            <!-- Produits charg√©s dynamiquement -->
        </div>
    </div>

    <!-- SIDEBAR PANIER -->
    <div class="panier-sidebar" id="panierSidebar">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>üõí Votre Panier</h3>
            <button onclick="closePanier()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">√ó</button>
        </div>
        <div id="panierItems"></div>
        <div class="total">Total : <span id="panierTotal">0.00</span> DT</div>
        <button class="btn btn-commander" onclick="openCommandeModal()">üöÄ Commander</button>
    </div>

    <!-- MODAL √âTAPE OBLIGATOIRE -->
    <div class="overlay" id="overlayCommande">
        <div class="modal-commande">
            <h2 style="color: var(--secondary); margin-bottom: 20px;">Finaliser la Commande</h2>
            <div style="margin-bottom: 20px;">
                <input type="text" id="clientNom" placeholder="Votre nom complet *" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid var(--accent); background: rgba(255,255,255,0.1); color: white;">
                <input type="tel" id="clientTel" placeholder="Votre t√©l√©phone *" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid var(--accent); background: rgba(255,255,255,0.1); color: white;">
            </div>
            
            <!-- √âTAPE OBLIGATOIRE D'ENREGISTREMENT -->
            <div id="etapeEnregistrement" style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin: 20px 0;">
                <h4 style="color: #ffc107;">‚ö†Ô∏è √âtape Obligatoire</h4>
                <p>La commande doit d'abord √™tre enregistr√©e dans notre syst√®me.</p>
                <button id="btnEnregistrer" onclick="enregistrerCommande()" style="background: #ffc107; color: #000; width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin: 10px 0;">
                    üíæ ENREGISTRER LA COMMANDE
                </button>
            </div>
            
            <!-- BOUTON FINAL D√âSACTIV√â INITIALEMENT -->
            <button id="btnFinaliser" onclick="finaliserCommande()" disabled style="background: #6c757d; color: white; width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 18px; cursor: not-allowed;">
                ‚è≥ Veuillez d'abord enregistrer ci-dessus
            </button>
            
            <div id="messageCommande" style="margin-top: 15px; padding: 10px; border-radius: 6px; display: none;"></div>
        </div>
    </div>

    <script>
        // ================ √âTAT GLOBAL ================
        let panier = JSON.parse(localStorage.getItem('panierMaxiJDC')) || [];
        let derniereCommandeEnregistree = null;

        // ================ FONCTIONS PANIER ================
        function ouvrirPanier() { document.getElementById('panierSidebar').classList.add('open'); }
        function closePanier() { document.getElementById('panierSidebar').classList.remove('open'); }
        document.getElementById('btnOpenPanier').onclick = ouvrirPanier;

        function ajouterAuPanier(productId, nom, prix) {
            const existing = panier.find(item => item.id === productId);
            if (existing) existing.qte++;
            else panier.push({ id: productId, nom, prix, qte: 1 });
            updatePanierUI();
            localStorage.setItem('panierMaxiJDC', JSON.stringify(panier));
        }

        function updatePanierUI() {
            document.getElementById('cartCount').textContent = panier.reduce((sum, item) => sum + item.qte, 0);
            const container = document.getElementById('panierItems');
            container.innerHTML = '';
            let total = 0;
            panier.forEach(item => {
                total += item.prix * item.qte;
                container.innerHTML += `
                    <div class="panier-item">
                        <span>${item.nom}</span>
                        <span>${item.qte} √ó ${item.prix.toFixed(2)} DT</span>
                    </div>
                `;
            });
            document.getElementById('panierTotal').textContent = total.toFixed(2);
        }

        // ================ MODAL COMMANDE ================
        function openCommandeModal() {
            if (panier.length === 0) return alert("Votre panier est vide !");
            document.getElementById('overlayCommande').style.display = 'flex';
            document.getElementById('btnFinaliser').disabled = true;
            document.getElementById('btnFinaliser').style.background = '#6c757d';
            document.getElementById('btnFinaliser').innerHTML = '‚è≥ Veuillez d\'abord enregistrer ci-dessus';
        }

        // ================ FONCTION OBLIGATOIRE D'ENREGISTREMENT ================
        function enregistrerCommande() {
            const nom = document.getElementById('clientNom').value.trim();
            const tel = document.getElementById('clientTel').value.trim();
            
            if (!nom || !tel) {
                showMessage('Veuillez remplir tous les champs obligatoires.', 'error');
                return;
            }

            // Cr√©er l'objet commande
            derniereCommandeEnregistree = {
                id: Date.now(),
                date: new Date().toLocaleString('fr-FR'),
                client: nom,
                telephone: tel,
                articles: panier.map(item => ({ nom: item.nom, qte: item.qte, prix: item.prix })),
                total: parseFloat(document.getElementById('panierTotal').textContent),
                statut: 'nouvelle',
                statutLabel: 'üÜï Nouvelle (en ligne)',
                source: 'application_web'
            };

            // Sauvegarder dans localStorage (pour suivi-commandes.html)
            let commandes = JSON.parse(localStorage.getItem('commandesMaxiJDC')) || [];
            commandes.push(derniereCommandeEnregistree);
            localStorage.setItem('commandesMaxiJDC', JSON.stringify(commandes));

            // Mettre √† jour l'interface
            showMessage(`‚úÖ Commande #${derniereCommandeEnregistree.id} enregistr√©e ! Vous pouvez maintenant finaliser.`, 'success');
            document.getElementById('btnEnregistrer').disabled = true;
            document.getElementById('btnEnregistrer').innerHTML = '‚úÖ COMMANDE ENREGISTR√âE';
            document.getElementById('btnEnregistrer').style.background = '#28a745';
            
            // Activer le bouton final
            document.getElementById('btnFinaliser').disabled = false;
            document.getElementById('btnFinaliser').style.background = '#00d4ff';
            document.getElementById('btnFinaliser').innerHTML = '‚úÖ FINALISER ET ENVOYER SUR WHATSAPP';
        }

        // ================ FONCTION DE FINALISATION ================
        function finaliserCommande() {
            if (!derniereCommandeEnregistree) {
                alert("Erreur : la commande n'a pas √©t√© enregistr√©e.");
                return;
            }

            // Pr√©parer le message WhatsApp
            const message = `Nouvelle commande MAXI JDC MARKET%0A%0A` +
                          `Client: ${derniereCommandeEnregistree.client}%0A` +
                          `T√©l√©phone: ${derniereCommandeEnregistree.telephone}%0A` +
                          `Total: ${derniereCommandeEnregistree.total} DT%0A%0A` +
                          `Articles:%0A` +
                          derniereCommandeEnregistree.articles.map(a => `- ${a.qte}x ${a.nom}`).join('%0A');
            
            // Ouvrir WhatsApp
            window.open(`https://wa.me/21625600978?text=${message}`, '_blank');
            
            // Confirmation et nettoyage
            alert('‚úÖ Commande envoy√©e sur WhatsApp ! Le service de livraison a √©t√© notifi√©.');
            panier = [];
            localStorage.removeItem('panierMaxiJDC');
            updatePanierUI();
            closePanier();
            document.getElementById('overlayCommande').style.display = 'none';
            document.getElementById('clientNom').value = '';
            document.getElementById('clientTel').value = '';
        }

        function showMessage(text, type) {
            const el = document.getElementById('messageCommande');
            el.textContent = text;
            el.style.display = 'block';
            el.style.background = type === 'error' ? '#dc3545' : '#28a745';
            el.style.color = 'white';
        }

        // ================ INITIALISATION ================
        function loadProducts() {
            // Charger depuis products.json ou donn√©es statiques
            const produits = [
                { id: 1, nom: "Lait 1L", prix: 1.5 },
                { id: 2, nom: "Pain", prix: 0.8 },
                { id: 3, nom: "Eau 1.5L", prix: 0.6 },
                { id: 4, nom: "Caf√© 250g", prix: 8.5 },
                { id: 5, nom: "Sucre 1kg", prix: 2.3 },
                { id: 6, nom: "Huile 1L", prix: 4.2 }
            ];
            
            const grid = document.getElementById('productsGrid');
            produits.forEach(p => {
                grid.innerHTML += `
                    <div class="product-card">
                        <h3>${p.nom}</h3>
                        <div class="product-price">${p.prix.toFixed(2)} DT</div>
                        <button class="btn" onclick="ajouterAuPanier(${p.id}, '${p.nom}', ${p.prix})">+ Ajouter</button>
                    </div>
                `;
            });
        }

        // D√©marrer l'application
        window.onload = function() {
            loadProducts();
            updatePanierUI();
        };
    </script>
</body>
</html>
