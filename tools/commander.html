<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAXI JDC MARKET - Nouvelle Commande</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 30px auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        .form-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #3498db; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; color: #2c3e50; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; transition: border 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: #3498db; outline: none; box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2); }
        .articles { margin-top: 20px; }
        .article { display: flex; gap: 15px; margin-bottom: 15px; align-items: center; }
        .article input { flex: 1; }
        .btn { background: #3498db; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; margin: 10px 5px; transition: all 0.3s; }
        .btn:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4); }
        .btn-add { background: #2ecc71; }
        .btn-add:hover { background: #27ae60; }
        .btn-save { background: #9b59b6; width: 100%; margin-top: 20px; }
        .btn-save:hover { background: #8e44ad; }
        .msg { text-align: center; padding: 15px; border-radius: 8px; margin-top: 20px; font-weight: bold; display: none; }
        .success { background: #d5f4e6; color: #27ae60; border: 1px solid #2ecc71; }
        .error { background: #fadbd8; color: #e74c3c; border: 1px solid #e74c3c; }
        .nav-links { text-align: center; margin-top: 30px; }
        .nav-links a { color: #3498db; text-decoration: none; font-weight: bold; margin: 0 15px; padding: 10px 20px; border-radius: 6px; border: 2px solid #3498db; transition: all 0.3s; }
        .nav-links a:hover { background: #3498db; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí MAXI JDC MARKET - Enregistrer une Commande</h1>

        <div class="form-section">
            <h2>Informations Client</h2>
            <label for="clientNom">Nom du Client *</label>
            <input type="text" id="clientNom" placeholder="Ex: Mohamed Ali" required>
            
            <label for="clientTel">T√©l√©phone</label>
            <input type="tel" id="clientTel" placeholder="Ex: 25 600 978">
        </div>

        <div class="form-section">
            <h2>Articles de la Commande</h2>
            <div class="articles" id="articlesContainer">
                <!-- Les lignes d'articles seront ajout√©es ici par JavaScript -->
                <div class="article">
                    <input type="text" class="article-nom" placeholder="Nom de l'article (ex: Lait 1L)" required>
                    <input type="number" class="article-qte" placeholder="Quantit√©" min="1" value="1" required>
                    <input type="number" step="0.01" class="article-prix" placeholder="Prix unitaire (DT)" min="0" required>
                    <button type="button" class="btn btn-remove" onclick="removeArticle(this)" style="background: #e74c3c;">üóë</button>
                </div>
            </div>
            <button type="button" class="btn btn-add" onclick="addArticle()">+ Ajouter un article</button>
        </div>

        <div class="form-section">
            <h2>Statut & Total</h2>
            <label for="statut">Statut de la commande</label>
            <select id="statut">
                <option value="nouvelle">üÜï Nouvelle</option>
                <option value="preparation">üë®‚Äçüç≥ En pr√©paration</option>
                <option value="pret">‚úÖ Pr√™te</option>
                <option value="livree">üöö Livr√©e</option>
            </select>
            
            <label for="totalCommande">Total Calcul√© (DT)</label>
            <input type="number" step="0.01" id="totalCommande" placeholder="0.00" readonly style="background-color: #f0f0f0; font-weight: bold; font-size: 18px;">
        </div>

        <button type="button" class="btn btn-save" onclick="enregistrerCommande()">üíæ Enregistrer cette commande</button>

        <div id="message" class="msg"></div>

        <div class="nav-links">
            <a href="suivi-commandes.html">üìä Voir le Tableau de Bord</a>
            <a href="gestion-stock.html">üì¶ G√©rer le Stock</a>
        </div>
    </div>

    <script>
        // Fonction pour ajouter une ligne d'article
        function addArticle() {
            const container = document.getElementById('articlesContainer');
            const newArticle = document.createElement('div');
            newArticle.className = 'article';
            newArticle.innerHTML = `
                <input type="text" class="article-nom" placeholder="Nom de l'article" required>
                <input type="number" class="article-qte" placeholder="Quantit√©" min="1" value="1" required>
                <input type="number" step="0.01" class="article-prix" placeholder="Prix unitaire (DT)" min="0" required>
                <button type="button" class="btn btn-remove" onclick="removeArticle(this)" style="background: #e74c3c;">üóë</button>
            `;
            container.appendChild(newArticle);
            updateTotal(); // Recalcule le total
        }

        // Fonction pour supprimer une ligne d'article
        function removeArticle(button) {
            if(document.querySelectorAll('.article').length > 1) {
                button.closest('.article').remove();
                updateTotal(); // Recalcule le total
            } else {
                alert("Une commande doit avoir au moins un article !");
            }
        }

        // Fonction pour calculer le total de la commande en temps r√©el
        function updateTotal() {
            let total = 0;
            document.querySelectorAll('.article').forEach(article => {
                const qte = parseFloat(article.querySelector('.article-qte').value) || 0;
                const prix = parseFloat(article.querySelector('.article-prix').value) || 0;
                total += qte * prix;
            });
            document.getElementById('totalCommande').value = total.toFixed(2);
        }

        // √âcoute les changements dans les champs pour recalculer le total
        document.getElementById('articlesContainer').addEventListener('input', updateTotal);

        // Fonction principale pour enregistrer la commande
        function enregistrerCommande() {
            const nomClient = document.getElementById('clientNom').value.trim();
            const telClient = document.getElementById('clientTel').value.trim();
            const statut = document.getElementById('statut').value;
            const total = parseFloat(document.getElementById('totalCommande').value);

            // Validation basique
            if(!nomClient) {
                showMessage('Veuillez saisir le nom du client.', 'error');
                return;
            }

            // R√©cup√©ration des articles
            const articles = [];
            document.querySelectorAll('.article').forEach(article => {
                const nom = article.querySelector('.article-nom').value.trim();
                const qte = parseFloat(article.querySelector('.article-qte').value);
                const prix = parseFloat(article.querySelector('.article-prix').value);
                
                if(nom && qte > 0 && prix >= 0) {
                    articles.push({ nom, qte, prix, total: (qte * prix).toFixed(2) });
                }
            });

            if(articles.length === 0) {
                showMessage('Veuillez ajouter au moins un article valide.', 'error');
                return;
            }

            // Cr√©ation de l'objet commande
            const nouvelleCommande = {
                id: Date.now(), // ID unique bas√© sur le timestamp
                date: new Date().toLocaleString('fr-FR'),
                client: nomClient,
                telephone: telClient || 'Non renseign√©',
                articles: articles,
                total: total.toFixed(2),
                statut: statut,
                statutLabel: document.getElementById('statut').options[document.getElementById('statut').selectedIndex].text
            };

            // Sauvegarde dans le stockage local du navigateur
            let commandes = JSON.parse(localStorage.getItem('commandesMaxiJDC')) || [];
            commandes.push(nouvelleCommande);
            localStorage.setItem('commandesMaxiJDC', JSON.stringify(commandes));

            // Confirmation et r√©initialisation
            showMessage(`‚úÖ Commande #${nouvelleCommande.id} enregistr√©e avec succ√®s pour ${nomClient} ! Total: ${total.toFixed(2)} DT`, 'success');
            document.getElementById('clientNom').value = '';
            document.getElementById('clientTel').value = '';
            
            // R√©initialise les articles (garder une seule ligne vide)
            const container = document.getElementById('articlesContainer');
            container.innerHTML = '';
            addArticle(); // Ajoute une ligne vide par d√©faut
            
            document.getElementById('statut').value = 'nouvelle';
            updateTotal();
        }

        // Fonction pour afficher des messages de feedback
        function showMessage(text, type) {
            const msgDiv = document.getElementById('message');
            msgDiv.textContent = text;
            msgDiv.className = `msg ${type}`;
            msgDiv.style.display = 'block';
            
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 5000);
        }

        // Initialisation : ajoute une premi√®re ligne d'article au chargement
        window.onload = function() {
            updateTotal();
        };
    </script>
</body>
</html>
