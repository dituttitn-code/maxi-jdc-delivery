<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques - MAXI JDC MARKET</title>
    <style>
        :root {
            --bg0: #0a1929;
            --bg1: #112240;
            --card: #1a365d;
            --card2: #162447;
            --line: rgba(255,255,255,.15);
            --text: #f0f6fc;
            --muted: #8b949e;
            --accent: #00ff88;
            --accent2: #00d4ff;
            --danger: #ff6b6b;
            --warning: #ffa726;
            --shadow: 0 10px 40px rgba(0,0,0,.5);
            --radius: 12px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            color: var(--text);
            background: linear-gradient(135deg, var(--bg0) 0%, var(--bg1) 100%);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
        }
        
        .logo-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            border: 2px solid var(--accent);
            display: grid;
            place-items: center;
            background: var(--bg0);
        }
        
        .brand-text h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .back-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent);
            cursor: pointer;
            font-weight: 700;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            transform: translateY(-2px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card);
            border-radius: var(--radius);
            border: 1px solid var(--line);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 900;
            color: var(--text);
            margin: 10px 0;
        }
        
        .stat-trend {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent);
        }
        
        .stat-trend.negative {
            background: rgba(255, 107, 107, 0.1);
            color: var(--danger);
        }
        
        .chart-container {
            background: var(--card);
            border-radius: var(--radius);
            border: 1px solid var(--line);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--line);
        }
        
        th {
            background: var(--card2);
            color: var(--accent);
            font-weight: 700;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .export-btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: 2px solid;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .export-btn.excel {
            border-color: #217346;
            color: #217346;
        }
        
        .export-btn.pdf {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
        }
        
        .date-filter {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .date-input {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            outline: none;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent);
            cursor: pointer;
            font-weight: 700;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }
    </style>
    <!-- Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-brand">
                <div class="logo">
                    <span style="font-size: 24px;">üìä</span>
                </div>
                <div class="brand-text">
                    <h1>Statistiques MAXI JDC MARKET</h1>
                    <p style="color: var(--muted);">Analyse d√©taill√©e des performances commerciales</p>
                </div>
            </div>
            <a href="../index.html" class="back-btn">
                ‚Üê Retour √† l'application
            </a>
        </div>
        
        <!-- Filtres par date -->
        <div class="date-filter">
            <div>
                <label style="display: block; margin-bottom: 5px; color: var(--muted);">Date de d√©but</label>
                <input type="date" id="startDate" class="date-input">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; color: var(--muted);">Date de fin</label>
                <input type="date" id="endDate" class="date-input">
            </div>
            <button id="applyFilter" class="filter-btn">
                üîç Appliquer le filtre
            </button>
            <button id="resetFilter" class="filter-btn" style="background: rgba(255,107,107,0.1); border-color: var(--danger); color: var(--danger);">
                ‚ü≥ R√©initialiser
            </button>
        </div>
        
        <!-- Cartes de statistiques principales -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">üí∞ Chiffre d'Affaires</div>
                    <span class="stat-trend">+12.5%</span>
                </div>
                <div class="stat-value" id="totalRevenue">0,00 dt</div>
                <div style="color: var(--muted); font-size: 14px;">30 derniers jours</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">üõí Commandes</div>
                    <span class="stat-trend">+8.3%</span>
                </div>
                <div class="stat-value" id="totalOrders">0</div>
                <div style="color: var(--muted); font-size: 14px;">Commandes trait√©es</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">üë• Clients</div>
                    <span class="stat-trend">+15.2%</span>
                </div>
                <div class="stat-value" id="totalCustomers">0</div>
                <div style="color: var(--muted); font-size: 14px;">Clients actifs</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">üìà Taux de Conversion</div>
                    <span class="stat-trend negative">-2.1%</span>
                </div>
                <div class="stat-value" id="conversionRate">0%</div>
                <div style="color: var(--muted); font-size: 14px;">Visite ‚Üí Commande</div>
            </div>
        </div>
        
        <!-- Graphique d'√©volution -->
        <div class="chart-container">
            <div class="chart-title">üìà √âvolution des ventes</div>
            <canvas id="salesChart"></canvas>
        </div>
        
        <!-- Graphique par cat√©gorie -->
        <div class="chart-container">
            <div class="chart-title">üè∑Ô∏è Ventes par cat√©gorie</div>
            <canvas id="categoryChart"></canvas>
        </div>
        
        <!-- Top produits -->
        <div class="chart-container">
            <div class="chart-title">üèÜ Top 10 des produits</div>
            <div style="overflow-x: auto;">
                <table id="topProductsTable">
                    <thead>
                        <tr>
                            <th>Rang</th>
                            <th>Produit</th>
                            <th>Quantit√©</th>
                            <th>CA g√©n√©r√©</th>
                            <th>Cat√©gorie</th>
                        </tr>
                    </thead>
                    <tbody id="topProductsBody">
                        <!-- Donn√©es dynamiques -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Informations clients -->
        <div class="chart-container">
            <div class="chart-title">üë• Comportement des clients</div>
            <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr);">
                <div class="stat-card">
                    <div class="stat-title">üß∫ Panier moyen</div>
                    <div class="stat-value" id="averageCart">0,00 dt</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">üîÑ Taux de fid√©lisation</div>
                    <div class="stat-value" id="retentionRate">0%</div>
                </div>
            </div>
        </div>
        
        <!-- Boutons d'export -->
        <div class="export-buttons">
            <button class="export-btn excel" id="exportExcel">
                üìä Exporter en Excel
            </button>
            <button class="export-btn pdf" id="exportPDF">
                üìÑ Exporter en PDF
            </button>
        </div>
    </div>
    
    <script>
        // ===================== CONFIGURATION =====================
        const CONFIG = {
            localStorageKey: 'maxi_jdc_market_app_v26',
            shippingFee: 3,
            freeShipping: 100,
            minOrder: 15
        };
        
        // ===================== DONN√âES D'EXEMPLE (√† remplacer par vos donn√©es r√©elles) =====================
        let salesData = {
            daily: [],
            monthly: [],
            byCategory: {},
            byProduct: {},
            customers: [],
            orders: []
        };
        
        // ===================== INITIALISATION =====================
        document.addEventListener('DOMContentLoaded', function() {
            loadSalesData();
            initializeCharts();
            updateStatsDisplay();
            setupEventListeners();
        });
        
        // ===================== CHARGEMENT DES DONN√âES =====================
        function loadSalesData() {
            try {
                // Charger l'historique des commandes depuis le localStorage
                const saved = localStorage.getItem(CONFIG.localStorageKey);
                if (saved) {
                    const data = JSON.parse(saved);
                    salesData.orders = data.orderHistory || [];
                    salesData.customers = extractCustomers(data.orderHistory);
                    
                    // Traiter les donn√©es pour les statistiques
                    processOrdersData(data.orderHistory);
                }
                
                // Donn√©es d'exemple si pas de donn√©es r√©elles
                if (salesData.orders.length === 0) {
                    generateSampleData();
                }
                
            } catch (error) {
                console.error('Erreur chargement donn√©es:', error);
                generateSampleData();
            }
        }
        
        function extractCustomers(orders) {
            const customersMap = new Map();
            
            orders.forEach(order => {
                if (order.clientPhone) {
                    if (!customersMap.has(order.clientPhone)) {
                        customersMap.set(order.clientPhone, {
                            phone: order.clientPhone,
                            name: order.clientName || 'Client',
                            totalOrders: 0,
                            totalSpent: 0,
                            firstOrder: order.date,
                            lastOrder: order.date
                        });
                    }
                    
                    const customer = customersMap.get(order.clientPhone);
                    customer.totalOrders++;
                    customer.totalSpent += order.total;
                    customer.lastOrder = order.date;
                }
            });
            
            return Array.from(customersMap.values());
        }
        
        function processOrdersData(orders) {
            // R√©initialiser les donn√©es
            salesData.daily = [];
            salesData.byCategory = {};
            salesData.byProduct = {};
            
            // Regrouper par jour
            const dailyMap = new Map();
            
            orders.forEach(order => {
                const date = new Date(order.date);
                const dateKey = date.toISOString().split('T')[0];
                
                // Donn√©es journali√®res
                if (!dailyMap.has(dateKey)) {
                    dailyMap.set(dateKey, {
                        date: dateKey,
                        revenue: 0,
                        orders: 0,
                        items: 0
                    });
                }
                
                const dayData = dailyMap.get(dateKey);
                dayData.revenue += order.total;
                dayData.orders++;
                dayData.items += order.items.reduce((sum, item) => sum + item.quantity, 0);
                
                // Donn√©es par produit
                order.items.forEach(item => {
                    const productKey = `${item.code}_${item.name}`;
                    
                    if (!salesData.byProduct[productKey]) {
                        salesData.byProduct[productKey] = {
                            name: item.name,
                            code: item.code,
                            category: item.category || 'Non cat√©goris√©',
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    
                    salesData.byProduct[productKey].quantity += item.quantity;
                    salesData.byProduct[productKey].revenue += item.total;
                });
            });
            
            // Convertir la Map en tableau tri√©
            salesData.daily = Array.from(dailyMap.values())
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30); // 30 derniers jours
        }
        
        function generateSampleData() {
            // G√©n√©rer des donn√©es d'exemple pour la d√©mo
            const categories = ['Caf√© & Th√©s', 'Fruits & L√©gumes', '√âpicerie Sal√©e', 'Boissons', 'Produits Frais'];
            const products = [
                { name: 'Caf√© Moulu 250g', code: 'CAF001', category: 'Caf√© & Th√©s' },
                { name: 'Th√© Vert 100g', code: 'THE002', category: 'Caf√© & Th√©s' },
                { name: 'Tomates 1kg', code: 'TOM003', category: 'Fruits & L√©gumes' },
                { name: 'P√¢tes Spaghetti 500g', code: 'PAT004', category: '√âpicerie Sal√©e' },
                { name: 'Eau Min√©rale 1.5L', code: 'EAU005', category: 'Boissons' },
                { name: 'Lait 1L', code: 'LAI006', category: 'Produits Frais' },
                { name: 'Fromage 200g', code: 'FRO007', category: 'Produits Frais' },
                { name: 'Biscuits Chocolat', code: 'BIS008', category: '√âpicerie Sucr√©e' }
            ];
            
            // G√©n√©rer 50 commandes al√©atoires
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 60); // 60 derniers jours
            
            for (let i = 0; i < 50; i++) {
                const orderDate = new Date(startDate);
                orderDate.setDate(orderDate.getDate() + Math.floor(Math.random() * 60));
                
                const itemsCount = Math.floor(Math.random() * 5) + 1;
                const items = [];
                let subtotal = 0;
                
                for (let j = 0; j < itemsCount; j++) {
                    const product = products[Math.floor(Math.random() * products.length)];
                    const quantity = Math.floor(Math.random() * 3) + 1;
                    const price = 5 + Math.random() * 20;
                    const total = price * quantity;
                    
                    items.push({
                        name: product.name,
                        code: product.code,
                        quantity: quantity,
                        price: price,
                        total: total,
                        category: product.category
                    });
                    
                    subtotal += total;
                }
                
                const shipping = subtotal >= CONFIG.freeShipping ? 0 : CONFIG.shippingFee;
                const total = subtotal + shipping;
                
                salesData.orders.push({
                    id: 1000 + i,
                    date: orderDate.toISOString(),
                    clientName: `Client ${i + 1}`,
                    clientPhone: `25${Math.floor(100000 + Math.random() * 900000)}`,
                    items: items,
                    subtotal: subtotal,
                    shipping: shipping,
                    total: total,
                    address: `Adresse ${i + 1}, Tunis`
                });
            }
            
            // Traiter les donn√©es g√©n√©r√©es
            salesData.customers = extractCustomers(salesData.orders);
            processOrdersData(salesData.orders);
        }
        
        // ===================== GRAPHIQUES =====================
        let salesChart, categoryChart;
        
        function initializeCharts() {
            // Graphique des ventes
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: salesData.daily.map(d => formatDate(d.date)),
                    datasets: [{
                        label: 'Chiffre d\'affaires (dt)',
                        data: salesData.daily.map(d => d.revenue),
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#f0f6fc'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#8b949e'
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#8b949e',
                                callback: function(value) {
                                    return value + ' dt';
                                }
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            }
                        }
                    }
                }
            });
            
            // Graphique par cat√©gorie
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            
            // Calculer le CA par cat√©gorie
            const categoryRevenue = {};
            salesData.orders.forEach(order => {
                order.items.forEach(item => {
                    const category = item.category || 'Non cat√©goris√©';
                    if (!categoryRevenue[category]) {
                        categoryRevenue[category] = 0;
                    }
                    categoryRevenue[category] += item.total;
                });
            });
            
            const categories = Object.keys(categoryRevenue);
            const revenues = Object.values(categoryRevenue);
            
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: revenues,
                        backgroundColor: [
                            '#00ff88',
                            '#00d4ff',
                            '#ff6b6b',
                            '#ffa726',
                            '#9575cd',
                            '#4db6ac',
                            '#ff8a65'
                        ],
                        borderWidth: 2,
                        borderColor: 'var(--bg0)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#f0f6fc',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }
        
        // ===================== AFFICHAGE DES STATISTIQUES =====================
        function updateStatsDisplay() {
            // Calculer les totaux
            const totalRevenue = salesData.orders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = salesData.orders.length;
            const totalCustomers = salesData.customers.length;
            
            // Taux de conversion (exemple)
            const conversionRate = Math.min(5 + Math.random() * 10, 15).toFixed(1);
            
            // Panier moyen
            const averageCart = totalOrders > 0 ? totalRevenue / totalOrders : 0;
            
            // Taux de fid√©lisation
            const retentionRate = Math.min(40 + Math.random() * 30, 80).toFixed(1);
            
            // Mettre √† jour les affichages
            document.getElementById('totalRevenue').textContent = formatPrice(totalRevenue);
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('conversionRate').textContent = conversionRate + '%';
            document.getElementById('averageCart').textContent = formatPrice(averageCart);
            document.getElementById('retentionRate').textContent = retentionRate + '%';
            
            // Mettre √† jour le tableau des top produits
            updateTopProductsTable();
        }
        
        function updateTopProductsTable() {
            const tbody = document.getElementById('topProductsBody');
            tbody.innerHTML = '';
            
            // Convertir l'objet en tableau et trier par revenu
            const productsArray = Object.values(salesData.byProduct)
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 10);
            
            productsArray.forEach((product, index) => {
                const row = document.createElement('tr');
                
                let medal = '';
                if (index === 0) medal = 'ü•á';
                else if (index === 1) medal = 'ü•à';
                else if (index === 2) medal = 'ü•â';
                
                row.innerHTML = `
                    <td><strong>${index + 1}</strong> ${medal}</td>
                    <td>${product.name}<br><small style="color: var(--muted);">${product.code}</small></td>
                    <td>${product.quantity}</td>
                    <td>${formatPrice(product.revenue)}</td>
                    <td>${product.category}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // ===================== FILTRES =====================
        function setupEventListeners() {
            document.getElementById('applyFilter').addEventListener('click', applyDateFilter);
            document.getElementById('resetFilter').addEventListener('click', resetDateFilter);
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);
            document.getElementById('exportPDF').addEventListener('click', exportToPDF);
            
            // D√©finir les dates par d√©faut
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);
            
            document.getElementById('startDate').valueAsDate = startDate;
            document.getElementById('endDate').valueAsDate = endDate;
        }
        
        function applyDateFilter() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                alert('Veuillez s√©lectionner une p√©riode valide');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                alert('La date de d√©but doit √™tre ant√©rieure √† la date de fin');
                return;
            }
            
            // Filtrer les commandes
            const filteredOrders = salesData.orders.filter(order => {
                const orderDate = new Date(order.date);
                return orderDate >= start && orderDate <= end;
            });
            
            // Mettre √† jour les donn√©es avec le filtre
            salesData.customers = extractCustomers(filteredOrders);
            processOrdersData(filteredOrders);
            
            // Mettre √† jour les graphiques
            updateCharts();
            updateStatsDisplay();
            
            showNotification(`Filtre appliqu√©: ${formatDate(startDate)} - ${formatDate(endDate)}`);
        }
        
        function resetDateFilter() {
            // R√©initialiser les dates
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);
            
            document.getElementById('startDate').valueAsDate = startDate;
            document.getElementById('endDate').valueAsDate = endDate;
            
            // Recharger toutes les donn√©es
            loadSalesData();
            updateCharts();
            updateStatsDisplay();
            
            showNotification('Filtre r√©initialis√©');
        }
        
        function updateCharts() {
            // Mettre √† jour le graphique des ventes
            salesChart.data.labels = salesData.daily.map(d => formatDate(d.date));
            salesChart.data.datasets[0].data = salesData.daily.map(d => d.revenue);
            salesChart.update();
            
            // Mettre √† jour le graphique par cat√©gorie
            const categoryRevenue = {};
            salesData.orders.forEach(order => {
                order.items.forEach(item => {
                    const category = item.category || 'Non cat√©goris√©';
                    if (!categoryRevenue[category]) {
                        categoryRevenue[category] = 0;
                    }
                    categoryRevenue[category] += item.total;
                });
            });
            
            const categories = Object.keys(categoryRevenue);
            const revenues = Object.values(categoryRevenue);
            
            categoryChart.data.labels = categories;
            categoryChart.data.datasets[0].data = revenues;
            categoryChart.update();
        }
        
        // ===================== EXPORT =====================
        function exportToExcel() {
            // Pr√©parer les donn√©es pour l'export
            const exportData = [
                ['Statistique', 'Valeur'],
                ['Chiffre d\'affaires total', formatPrice(salesData.orders.reduce((sum, o) => sum + o.total, 0))],
                ['Nombre de commandes', salesData.orders.length],
                ['Nombre de clients', salesData.customers.length],
                ['Panier moyen', formatPrice(salesData.orders.length > 0 ? 
                    salesData.orders.reduce((sum, o) => sum + o.total, 0) / salesData.orders.length : 0)],
                [''],
                ['Top Produits', 'Quantit√©', 'CA g√©n√©r√©'],
                ...Object.values(salesData.byProduct)
                    .sort((a, b) => b.revenue - a.revenue)
                    .slice(0, 10)
                    .map(p => [p.name, p.quantity, formatPrice(p.revenue)])
            ];
            
            // Convertir en CSV
            const csvContent = exportData.map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');
            
            // Cr√©er et t√©l√©charger le fichier
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `statistiques-maxi-jdc-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Export Excel g√©n√©r√© avec succ√®s');
        }
        
        function exportToPDF() {
            showNotification('Fonction PDF en d√©veloppement');
            // Impl√©mentation PDF n√©cessite une biblioth√®que comme jsPDF
            // window.jsPDF = window.jspdf.jsPDF;
            // const doc = new jsPDF();
            // doc.text('Statistiques MAXI JDC MARKET', 20, 20);
            // doc.save('statistiques.pdf');
        }
        
        // ===================== UTILITAIRES =====================
        function formatPrice(amount) {
            return Number(amount).toFixed(2).replace('.', ',') + ' dt';
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit'
            });
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--accent);
                color: var(--bg0);
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 700;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
