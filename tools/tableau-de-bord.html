<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - MAXI JDC MARKET</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #0a1929; --secondary: #00ff88; --accent: #00d4ff; --light: #f0f6fc; --dark: #1a365d; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, var(--primary) 0%, #112240 100%); color: var(--light); min-height: 100vh; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header h1 { background: linear-gradient(90deg, var(--secondary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav a { color: var(--light); text-decoration: none; margin-left: 15px; padding: 8px 15px; border-radius: 6px; background: rgba(0, 255, 136, 0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--secondary); }
        .stat-value { font-size: 32px; font-weight: bold; color: var(--secondary); }
        .charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-top: 30px; }
        .chart-container { background: var(--dark); padding: 20px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Tableau de Bord Analytique</h1>
        <div class="nav">
            <a href="index.html">üè† Accueil</a>
            <a href="suivi-commandes.html">üìã Suivi</a>
            <a href="commander.html">üõí Commander</a>
        </div>
    </div>

    <div class="stats-grid" id="statsGrid">
        <!-- Rempli dynamiquement -->
    </div>

    <div class="charts">
        <div class="chart-container">
            <h3>Commandes par Statut</h3>
            <canvas id="chartStatuts"></canvas>
        </div>
        <div class="chart-container">
            <h3>Chiffre d'Affaires Hebdomadaire</h3>
            <canvas id="chartCA"></canvas>
        </div>
    </div>

    <script>
        function loadDashboard() {
            const commandes = JSON.parse(localStorage.getItem('commandesMaxiJDC')) || [];
            
            // STATISTIQUES
            const totalCA = commandes.reduce((sum, cmd) => sum + parseFloat(cmd.total), 0);
            const nbCommandes = commandes.length;
            const nbNouvelles = commandes.filter(c => c.statut === 'nouvelle').length;
            const moyenne = nbCommandes > 0 ? (totalCA / nbCommandes).toFixed(2) : 0;
            
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div>Chiffre d'Affaires Total</div>
                    <div class="stat-value">${totalCA.toFixed(2)} DT</div>
                </div>
                <div class="stat-card">
                    <div>Commandes Total</div>
                    <div class="stat-value">${nbCommandes}</div>
                </div>
                <div class="stat-card">
                    <div>Commandes en Attente</div>
                    <div class="stat-value">${nbNouvelles}</div>
                </div>
                <div class="stat-card">
                    <div>Moyenne / Commande</div>
                    <div class="stat-value">${moyenne} DT</div>
                </div>
            `;

            // GRAPHIQUE 1 : Commandes par statut
            const ctx1 = document.getElementById('chartStatuts').getContext('2d');
            const statutsCount = {
                'nouvelle': commandes.filter(c => c.statut === 'nouvelle').length,
                'preparation': commandes.filter(c => c.statut === 'preparation').length,
                'pret': commandes.filter(c => c.statut === 'pret').length,
                'livree': commandes.filter(c => c.statut === 'livree').length
            };
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Nouvelles', 'En pr√©paration', 'Pr√™tes', 'Livr√©es'],
                    datasets: [{
                        data: Object.values(statutsCount),
                        backgroundColor: ['#ff6b6b', '#ffd93d', '#6bcf7f', '#4d96ff']
                    }]
                }
            });

            // GRAPHIQUE 2 : CA des 7 derniers jours
            const ctx2 = document.getElementById('chartCA').getContext('2d');
            const last7Days = [...Array(7)].map((_, i) => {
                const d = new Date(); d.setDate(d.getDate() - i); return d.toLocaleDateString('fr-FR');
            }).reverse();
            const caParJour = last7Days.map(date => {
                return commandes.filter(c => c.date.includes(date)).reduce((sum, cmd) => sum + parseFloat(cmd.total), 0);
            });
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Chiffre d\'Affaires (DT)',
                        data: caParJour,
                        borderColor: '#00ff88',
                        tension: 0.3
                    }]
                }
            });
        }

        window.onload = loadDashboard;
        setInterval(loadDashboard, 30000); // Rafra√Æchir toutes les 30 secondes
    </script>
</body>
</html>
